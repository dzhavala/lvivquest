var UserLocation = function(){  // Returns a $.promise object with users location in google.maps.LatLng format  function listenForUserPosition(sussessCallback, errorCallback) {    //var dfd = $.Deferred();    // Try W3C Geolocation (Preferred)    console.log('listenForUserPosition', navigator.geolocation);    if(navigator.geolocation) {      navigator.geolocation.getCurrentPosition(function(position) {        console.log('getCurrentPosition', position);        //dfd.resolve(new google.maps.LatLng(position.coords.latitude,position.coords.longitude));      }, function() {        console.log('getCurrentPosition Error');        //dfd.reject("Geolocation service failed. Turn on Geolocation servise on your device");      });      navigator.geolocation.watchPosition(function(position) {        console.log('watchPosition', position);        //dfd.resolve(new google.maps.LatLng(position.coords.latitude,position.coords.longitude));        sussessCallback(new google.maps.LatLng(position.coords.latitude,position.coords.longitude));      }, function() {        console.log('watchPosition Error');        //dfd.reject("Geolocation service failed. Turn on Geolocation servise on your device");        errorCallback("Geolocation service failed. Turn on Geolocation servise on your device");      },      {        enableHighAccuracy : true,        maximumAge : 1      });    }    // Browser doesn't support Geolocation    else {      //dfd.reject("Your browser doesn't support geolocation.");      errorCallback("Your browser doesn't support geolocation.");    }    //return dfd.promise();  }  return {      listenForUserPosition:listenForUserPosition  };}();